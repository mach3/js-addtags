/*
 * AddTags.js
 * Copyright (c) Matsukaze. All rights reserved.
 * @author mach3
 * @version 1.0
 * @requires jQuery 1.4 or later
 */
var AddTags=function(a){this.setTags(a)};AddTags.prototype={EVENT_CHANGE:"change",tags:[],option:{form:"form#addtag",input:"input#taginput",list:"ul#taglist",deleteButton:"#taglist li input.delete"},setTags:function(a){this.tags=a||[];return this},config:function(a){this.option=$.extend({},this.option,a);return this},run:function(){$(this.option.form).bind("submit",$.proxy(this._onSubmit,this));$(this.option.deleteButton).live("click",$.proxy(this._onDelete,this));this.refreshList();return this},_onSubmit:function(){var a=$(this.option.input);this.add(a.val())&&this.refreshList();a.val("");return false},_onDelete:function(a){this.remove($(a.target).attr("data-tag"))},add:function(a){var c,b;c=this;b=false;a=a.replace(/^\s+|\s+$/,"").split(",");$.each(a,function(e,d){if(!d.length){return}c.tags.push(d);c.tags.sort();c.tags=$.unique(c.tags).sort();b=true});if(b){$(this).trigger(this.EVENT_CHANGE)}return true},remove:function(a){var b=this.tags.length;this.tags=$.grep(this.tags,function(c,d){return c!==a});this.refreshList();if(this.tags.length!==b){$(this).trigger(this.EVENT_CHANGE)}return this},clear:function(){this.tags=[];this.refreshList();$(this).trigger(this.EVENT_CHANGE);return this},refreshList:function(){var a,b;a='<li>{{tag}} <input type="button" value="X" class="delete" data-tag="{{tag}}" /></li>';b=$(this.option.list).html("");$.each(this.tags,function(d,c){$(a.replace(/{{tag}}/g,c)).appendTo(b)});return this},toString:function(){return this.tags.join(",")},bind:function(a,b){$(this).bind(a,b)},unbind:function(a,b){$(this).unbind(a,b)}};
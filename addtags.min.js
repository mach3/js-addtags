/*
 * AddTags.js
 * Copyright (c) Matsukaze. All rights reserved.
 * @author mach3
 * @version 1.1
 * @requires jQuery 1.4 or later
 */
var AddTags=function(a){this.setTags(a)};AddTags.prototype={EVENT_CHANGE:"change",tags:[],option:{tagInput:"#tagInput",tagAddButton:"#tagAddButton",tagResetButton:"#tagResetButton",tagList:"#tagList",tagDeleteButton:"#tagList li input.delete"},setTags:function(a){this.tags=a||[];return this},config:function(a){this.option=$.extend({},this.option,a);return this},run:function(){$(this.option.tagInput).bind("keypress",$.proxy(this._onKeyPress,this));$(this.option.tagAddButton).bind("click",$.proxy(this._onClickAdd,this));$(this.option.tagResetButton).bind("click",$.proxy(this.clear,this));$(this.option.tagDeleteButton).live("click",$.proxy(this._onClickDelete,this));this.refreshList();return this},_onKeyPress:function(a){if(a.keyCode!==13){return}this._onClickAdd()},_onClickAdd:function(){var a=$(this.option.tagInput);this.add(a.val());a.val("")},_onClickDelete:function(a){this.remove($(a.target).attr("data-tag"))},add:function(a){var c,b;c=this;b=false;a=a.replace(/^\s+|\s+$/,"").split(",");$.each(a,function(e,d){if(!d.length){return}c.tags.push(d);c.tags.sort();c.tags=$.unique(c.tags).sort();b=true});if(b){$(this).trigger(this.EVENT_CHANGE)}this.refreshList();return this},remove:function(a){this.tags=$.grep(this.tags,function(b,c){return b!==a});this.refreshList();$(this).trigger(this.EVENT_CHANGE);return this},clear:function(){this.tags=[];this.refreshList();$(this).trigger(this.EVENT_CHANGE);return this},refreshList:function(){var a,b;a='<li>{{tag}} <input type="button" value="X" class="delete" data-tag="{{tag}}" /></li>';b=$(this.option.tagList).html("");this.tags.sort();$.each(this.tags,function(d,c){$(a.replace(/{{tag}}/g,c)).appendTo(b)});return this},toString:function(){return this.tags.join(",")},bind:function(a,b){return $(this).bind(a,b)},unbind:function(a,b){return $(this).unbind(a,b)}};